<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>五、生态-elk收集系统日志 | 蚂蚁博客</title><meta name="description" content="特别鸣谢  ​        filebeat 梦轻尘 利用 Log-Pilot + Kafka+Elasticsearch + Kibana 搭建 kubernetes日志解决方案 ​        国内镜像源 天凉好个秋  CentOS yum、docker、alpine apk、maven 国内镜像源 架构图 部署elasticsearch  官网  下载地址  下载安装包wget -o &amp;"><meta name="keywords" content="kubernetes,老男孩,实战交付"><meta name="author" content="会跳的小蚂蚁"><meta name="copyright" content="会跳的小蚂蚁"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="五、生态-elk收集系统日志"><meta name="twitter:description" content="特别鸣谢  ​        filebeat 梦轻尘 利用 Log-Pilot + Kafka+Elasticsearch + Kibana 搭建 kubernetes日志解决方案 ​        国内镜像源 天凉好个秋  CentOS yum、docker、alpine apk、maven 国内镜像源 架构图 部署elasticsearch  官网  下载地址  下载安装包wget -o &amp;"><meta name="twitter:image" content="http://wang.ikongjian.com/img/gkihqEjXxJ5UZ1C.jpg"><meta property="og:type" content="article"><meta property="og:title" content="五、生态-elk收集系统日志"><meta property="og:url" content="http://wang.ikongjian.com/2020/06/10/%E4%BA%94%E3%80%81%E7%94%9F%E6%80%81-elk%E6%94%B6%E9%9B%86%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97/"><meta property="og:site_name" content="蚂蚁博客"><meta property="og:description" content="特别鸣谢  ​        filebeat 梦轻尘 利用 Log-Pilot + Kafka+Elasticsearch + Kibana 搭建 kubernetes日志解决方案 ​        国内镜像源 天凉好个秋  CentOS yum、docker、alpine apk、maven 国内镜像源 架构图 部署elasticsearch  官网  下载地址  下载安装包wget -o &amp;"><meta property="og:image" content="http://wang.ikongjian.com/img/gkihqEjXxJ5UZ1C.jpg"><meta property="article:published_time" content="2020-06-10T02:00:00.000Z"><meta property="article:modified_time" content="2020-06-16T08:12:18.941Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://wang.ikongjian.com/2020/06/10/%E4%BA%94%E3%80%81%E7%94%9F%E6%80%81-elk%E6%94%B6%E9%9B%86%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97/"><link rel="prev" title="一、常用软件-nexus私服" href="http://wang.ikongjian.com/2020/06/16/%E4%B8%80%E3%80%81%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6-nexus%E7%A7%81%E6%9C%8D/"><link rel="next" title="四、生态-prometheus系统监控" href="http://wang.ikongjian.com/2020/06/09/%E5%9B%9B%E3%80%81%E7%94%9F%E6%80%81-prometheus%E7%B3%BB%E7%BB%9F%E7%9B%91%E6%8E%A7/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: true
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">18</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">10</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">10</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 列表</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/Gallery/"><i class="fa-fw fa fa-picture-o"></i><span> 照片</span></a></li><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#架构图"><span class="toc-number">1.</span> <span class="toc-text">架构图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#部署elasticsearch"><span class="toc-number">2.</span> <span class="toc-text">部署elasticsearch</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#下载安装包"><span class="toc-number">2.1.</span> <span class="toc-text">下载安装包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#修改配置文件"><span class="toc-number">2.2.</span> <span class="toc-text">修改配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建普通用户"><span class="toc-number">2.3.</span> <span class="toc-text">创建普通用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#启动es"><span class="toc-number">2.4.</span> <span class="toc-text">启动es</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#调整ES日志模板"><span class="toc-number">2.5.</span> <span class="toc-text">调整ES日志模板</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#部署Kafka"><span class="toc-number">3.</span> <span class="toc-text">部署Kafka</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#修改配置"><span class="toc-number">3.1.</span> <span class="toc-text">修改配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#启动Kafka"><span class="toc-number">3.2.</span> <span class="toc-text">启动Kafka</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#部署kafka-manager"><span class="toc-number">4.</span> <span class="toc-text">部署kafka-manager</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#准备镜像"><span class="toc-number">4.1.</span> <span class="toc-text">准备镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#准备资源配置清单"><span class="toc-number">4.2.</span> <span class="toc-text">准备资源配置清单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#应用资源配置清单"><span class="toc-number">4.3.</span> <span class="toc-text">应用资源配置清单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web界面管理"><span class="toc-number">4.4.</span> <span class="toc-text">web界面管理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#部署filebeat"><span class="toc-number">5.</span> <span class="toc-text">部署filebeat</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#下载镜像-二选一"><span class="toc-number">5.1.</span> <span class="toc-text">下载镜像(二选一)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义镜像-推荐，二选一"><span class="toc-number">5.2.</span> <span class="toc-text">自定义镜像(推荐，二选一)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#拉取master的代码"><span class="toc-number">5.2.1.</span> <span class="toc-text">拉取master的代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改filebeat模板"><span class="toc-number">5.2.2.</span> <span class="toc-text">修改filebeat模板</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#构建镜像"><span class="toc-number">5.2.3.</span> <span class="toc-text">构建镜像</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置资源清单"><span class="toc-number">5.3.</span> <span class="toc-text">配置资源清单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#执行资源配置清单"><span class="toc-number">5.4.</span> <span class="toc-text">执行资源配置清单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#收集服务日志"><span class="toc-number">5.5.</span> <span class="toc-text">收集服务日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#验证Kafka"><span class="toc-number">5.6.</span> <span class="toc-text">验证Kafka</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#部署logstash"><span class="toc-number">6.</span> <span class="toc-text">部署logstash</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#准备镜像-1"><span class="toc-number">6.1.</span> <span class="toc-text">准备镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#准备配置文件"><span class="toc-number">6.2.</span> <span class="toc-text">准备配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#测试logstash启动"><span class="toc-number">6.3.</span> <span class="toc-text">测试logstash启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查看es是否接收数据"><span class="toc-number">6.4.</span> <span class="toc-text">查看es是否接收数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#生产logstash启动"><span class="toc-number">6.5.</span> <span class="toc-text">生产logstash启动</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#部署kibana"><span class="toc-number">7.</span> <span class="toc-text">部署kibana</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#准备镜像-2"><span class="toc-number">7.1.</span> <span class="toc-text">准备镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#准备资源配置清单-1"><span class="toc-number">7.2.</span> <span class="toc-text">准备资源配置清单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#执行资源配置清单-1"><span class="toc-number">7.3.</span> <span class="toc-text">执行资源配置清单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web展示"><span class="toc-number">7.4.</span> <span class="toc-text">web展示</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(/img/gkihqEjXxJ5UZ1C.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">蚂蚁博客</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 列表</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/Gallery/"><i class="fa-fw fa fa-picture-o"></i><span> 照片</span></a></li><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">五、生态-elk收集系统日志</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-06-10 10:00:00"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-06-10</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-06-16 16:12:18"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-06-16</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/kubernetes/">kubernetes</a><i class="fa fa-angle-right post-meta__separator" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/kubernetes/%E8%80%81%E7%94%B7%E5%AD%A9/">老男孩</a><i class="fa fa-angle-right post-meta__separator" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/kubernetes/%E8%80%81%E7%94%B7%E5%AD%A9/%E5%AE%9E%E6%88%98%E4%BA%A4%E4%BB%98/">实战交付</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">2.8k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 15 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><p><strong>特别鸣谢</strong> </p>
<p>​        filebeat 梦轻尘 <a href="https://www.cnblogs.com/uglyliu/p/12382214.html" target="_blank" rel="noopener">利用 Log-Pilot + Kafka+Elasticsearch + Kibana 搭建 kubernetes日志解决方案</a></p>
<p>​        国内镜像源 天凉好个秋  <a href="https://www.jianshu.com/p/9e291ca4d16d" target="_blank" rel="noopener">CentOS yum、docker、alpine apk、maven 国内镜像源</a></p>
<h2 id="架构图"><a href="#架构图" class="headerlink" title="架构图"></a>架构图</h2><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfn8lzlosbj310h0hxq5r.jpg" alt="elk架构图"></p>
<h2 id="部署elasticsearch"><a href="#部署elasticsearch" class="headerlink" title="部署elasticsearch"></a>部署elasticsearch</h2><blockquote>
<p> <a href="https://www.elastic.co/" target="_blank" rel="noopener">官网</a>  <a href="https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.8.6.tar.gz" target="_blank" rel="noopener">下载地址</a></p>
</blockquote>
<h3 id="下载安装包"><a href="#下载安装包" class="headerlink" title="下载安装包"></a>下载安装包</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget -o &#x2F;data&#x2F;soft&#x2F;centos7&#x2F;elasticsearch-6.8.3.tar.gz https:&#x2F;&#x2F;artifacts.elastic.co&#x2F;downloads&#x2F;elasticsearch&#x2F;elasticsearch-6.8.3.tar.gz</span><br></pre></td></tr></table></figure>

<p>在wang-12上解压elasticsearch</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">scp wang-200:&#x2F;data&#x2F;soft&#x2F;centos7&#x2F;elasticsearch-6.8.3.tar.gz &#x2F;opt&#x2F;src&#x2F;elasticsearch-6.8.3.tar.gz</span><br><span class="line">tar xf &#x2F;opt&#x2F;src&#x2F;elasticsearch-6.8.3.tar.gz -C &#x2F;opt&#x2F;</span><br><span class="line">ln -s &#x2F;opt&#x2F;elasticsearch-6.8.3 &#x2F;opt&#x2F;elasticsearch</span><br><span class="line">mkdir -p &#x2F;data&#x2F;elasticsearch&#x2F;&#123;data,logs&#125;</span><br><span class="line">cd &#x2F;opt&#x2F;elasticsearch</span><br></pre></td></tr></table></figure>

<h3 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; config&#x2F;elasticsearch.yml</span><br><span class="line">cluster.name: es.od.com</span><br><span class="line">node.name: wang-12.host.com</span><br><span class="line">path.data: &#x2F;data&#x2F;elasticsearch&#x2F;data</span><br><span class="line">path.logs: &#x2F;data&#x2F;elasticsearch&#x2F;logs</span><br><span class="line">bootstrap.memory_lock: true</span><br><span class="line">network.host: 192.168.70.12</span><br><span class="line">http.port: 9200</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>修改jvm</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@wang-12 elasticsearch]# vim config&#x2F;jvm.options </span><br><span class="line">-Xms512m  # 根据环境设置，-Xms和-Xmx设置为相同的值，推荐设置为机器内存的一半左右 </span><br><span class="line">-Xmx512m</span><br></pre></td></tr></table></figure>

<h3 id="创建普通用户"><a href="#创建普通用户" class="headerlink" title="创建普通用户"></a>创建普通用户</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">useradd -s &#x2F;bin&#x2F;bash -M es</span><br><span class="line">chown -R es.es &#x2F;opt&#x2F;elasticsearch-6.8.3  &#x2F;data&#x2F;elasticsearch&#x2F;</span><br></pre></td></tr></table></figure>

<p>文件描述符</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; &#x2F;etc&#x2F;security&#x2F;limits.d&#x2F;es.conf</span><br><span class="line">es hard nofile 65536</span><br><span class="line">es soft fsize unlimited</span><br><span class="line">es hard memlock unlimited</span><br><span class="line">es soft memlock unlimited</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>调整内核参数</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sysctl -w vm.max_map_count&#x3D;262144</span><br><span class="line">echo &quot;vm.max_map_count&#x3D;262144&quot; &gt; &#x2F;etc&#x2F;sysctl.conf</span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>

<h3 id="启动es"><a href="#启动es" class="headerlink" title="启动es"></a>启动es</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@wang-12 elasticsearch]# su es -c &quot;&#x2F;opt&#x2F;elasticsearch&#x2F;bin&#x2F;elasticsearch -d&quot; </span><br><span class="line">[root@wang-12 elasticsearch]# netstat -luntp|grep 9200</span><br><span class="line">tcp6       0      0 192.168.70.12:9200      :::*                    LISTEN      124790&#x2F;java</span><br></pre></td></tr></table></figure>

<h3 id="调整ES日志模板"><a href="#调整ES日志模板" class="headerlink" title="调整ES日志模板"></a>调整ES日志模板</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -H &quot;Content-Type:application&#x2F;json&quot; -XPUT http:&#x2F;&#x2F;192.168.70.12:9200&#x2F;_template&#x2F;k8s -d &#39;&#123;</span><br><span class="line"> &quot;template&quot; : &quot;k8s*&quot;,</span><br><span class="line"> &quot;index_patterns&quot;: [&quot;k8s*&quot;], </span><br><span class="line"> &quot;settings&quot;: &#123;</span><br><span class="line">  &quot;number_of_shards&quot;: 5,</span><br><span class="line">  &quot;number_of_replicas&quot;: 0    </span><br><span class="line"> &#125;</span><br><span class="line">&#125;&#39;</span><br><span class="line"></span><br><span class="line"># 返回值 &#123;&quot;acknowledged&quot;:true&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>“number_of_replicas”: 0 生产为3份副本集，本es为单节点，不能配置副本集</p>
</blockquote>
<h2 id="部署Kafka"><a href="#部署Kafka" class="headerlink" title="部署Kafka"></a>部署Kafka</h2><p>在运维主机下载kafaka</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;archive.apache.org&#x2F;dist&#x2F;kafka&#x2F;2.2.0&#x2F;kafka_2.12-2.2.0.tgz -O &#x2F;data&#x2F;soft&#x2F;centos7&#x2F;kafka_2.12-2.2.0.tgz</span><br></pre></td></tr></table></figure>

<p>在wang-11解压kafaka</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">scp wang-200:&#x2F;data&#x2F;soft&#x2F;centos7&#x2F;kafka_2.12-2.2.0.tgz &#x2F;opt&#x2F;src&#x2F;</span><br><span class="line">tar xf &#x2F;opt&#x2F;src&#x2F;kafka_2.12-2.2.0.tgz -C &#x2F;opt&#x2F;</span><br><span class="line">ln -s &#x2F;opt&#x2F;kafka_2.12-2.2.0&#x2F; &#x2F;opt&#x2F;kafka</span><br><span class="line">mkdir &#x2F;data&#x2F;kafka&#x2F;logs -p</span><br><span class="line">cd &#x2F;opt&#x2F;kafka</span><br></pre></td></tr></table></figure>

<h3 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@wang-11 kafka]# vim config&#x2F;server.properties</span><br><span class="line">log.dirs&#x3D;&#x2F;data&#x2F;kafka&#x2F;logs</span><br><span class="line">zookeeper.connect&#x3D;localhost:2181    # zk消息队列地址 </span><br><span class="line">log.flush.interval.messages&#x3D;10000</span><br><span class="line">log.flush.interval.ms&#x3D;1000</span><br><span class="line"># 最后两行追加</span><br><span class="line">delete.topic.enable&#x3D;true						</span><br><span class="line">host.name&#x3D;wang-11.host.com</span><br></pre></td></tr></table></figure>

<h3 id="启动Kafka"><a href="#启动Kafka" class="headerlink" title="启动Kafka"></a>启动Kafka</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@wang-11 kafka]# bin&#x2F;kafka-server-start.sh -daemon config&#x2F;server.properties</span><br><span class="line">[root@wang-11 kafka]# netstat -luntp|grep 9092</span><br><span class="line">tcp6       0      0 192.168.70.11:9092      :::*                    LISTEN      110908&#x2F;java</span><br></pre></td></tr></table></figure>



<h2 id="部署kafka-manager"><a href="#部署kafka-manager" class="headerlink" title="部署kafka-manager"></a>部署kafka-manager</h2><blockquote>
<p><a href="https://github.com/yahoo/kafka-manager" target="_blank" rel="noopener">官方github地址</a></p>
</blockquote>
<h3 id="准备镜像"><a href="#准备镜像" class="headerlink" title="准备镜像"></a>准备镜像</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker pull sheepkiller&#x2F;kafka-manager:latest</span><br><span class="line">docker tag 4e4a8c5dabab harbor.od.com&#x2F;infra&#x2F;kafka-manager:latest</span><br><span class="line">docker push harbor.od.com&#x2F;infra&#x2F;kafka-manager:latest</span><br></pre></td></tr></table></figure>

<h3 id="准备资源配置清单"><a href="#准备资源配置清单" class="headerlink" title="准备资源配置清单"></a>准备资源配置清单</h3><p>创建资源配置清单文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir &#x2F;data&#x2F;k8s&#x2F;yaml&#x2F;kafka-manager</span><br></pre></td></tr></table></figure>

<p><strong>deploy.yaml</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; &#x2F;data&#x2F;k8s&#x2F;yaml&#x2F;kafka-manager&#x2F;deploy.yaml</span><br><span class="line">kind: Deployment</span><br><span class="line">apiVersion: extensions&#x2F;v1beta1</span><br><span class="line">metadata:</span><br><span class="line">  name: kafka-manager</span><br><span class="line">  namespace: infra</span><br><span class="line">  labels: </span><br><span class="line">    name: kafka-manager</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels: </span><br><span class="line">      name: kafka-manager</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels: </span><br><span class="line">        app: kafka-manager</span><br><span class="line">        name: kafka-manager</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: kafka-manager</span><br><span class="line">        image: harbor.od.com&#x2F;infra&#x2F;kafka-manager:latest</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 9000</span><br><span class="line">          protocol: TCP</span><br><span class="line">        env:</span><br><span class="line">        - name: ZK_HOSTS</span><br><span class="line">          value: zk1.od.com:2181</span><br><span class="line">        - name: APPLICATION_SECRET</span><br><span class="line">          value: letmein</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">      imagePullSecrets:</span><br><span class="line">      - name: harbor</span><br><span class="line">      restartPolicy: Always</span><br><span class="line">      terminationGracePeriodSeconds: 30</span><br><span class="line">      securityContext: </span><br><span class="line">        runAsUser: 0</span><br><span class="line">      schedulerName: default-scheduler</span><br><span class="line">  strategy:</span><br><span class="line">    type: RollingUpdate</span><br><span class="line">    rollingUpdate: </span><br><span class="line">      maxUnavailable: 1</span><br><span class="line">      maxSurge: 1</span><br><span class="line">  revisionHistoryLimit: 7</span><br><span class="line">  progressDeadlineSeconds: 600</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p><strong>svc.yaml</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; &#x2F;data&#x2F;k8s&#x2F;yaml&#x2F;kafka-manager&#x2F;svc.yaml</span><br><span class="line">kind: Service</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata: </span><br><span class="line">  name: kafka-manager</span><br><span class="line">  namespace: infra</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - protocol: TCP</span><br><span class="line">    port: 9000</span><br><span class="line">    targetPort: 9000</span><br><span class="line">  selector: </span><br><span class="line">    app: kafka-manager</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p><strong>ingress.yaml</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; &#x2F;data&#x2F;k8s&#x2F;yaml&#x2F;kafka-manager&#x2F;ingress.yaml</span><br><span class="line">kind: Ingress</span><br><span class="line">apiVersion: extensions&#x2F;v1beta1</span><br><span class="line">metadata: </span><br><span class="line">  name: kafka-manager</span><br><span class="line">  namespace: infra</span><br><span class="line">spec:</span><br><span class="line">  rules:</span><br><span class="line">  - host: km.od.com</span><br><span class="line">    http:</span><br><span class="line">      paths:</span><br><span class="line">      - path: &#x2F;</span><br><span class="line">        backend: </span><br><span class="line">          serviceName: kafka-manager</span><br><span class="line">          servicePort: 9000</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h3 id="应用资源配置清单"><a href="#应用资源配置清单" class="headerlink" title="应用资源配置清单"></a>应用资源配置清单</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kubectl apply -f http:&#x2F;&#x2F;doc.k8s.od.com&#x2F;yaml&#x2F;kafka-manager&#x2F;deploy.yaml</span><br><span class="line">kubectl apply -f http:&#x2F;&#x2F;doc.k8s.od.com&#x2F;yaml&#x2F;kafka-manager&#x2F;svc.yaml</span><br><span class="line">kubectl apply -f http:&#x2F;&#x2F;doc.k8s.od.com&#x2F;yaml&#x2F;kafka-manager&#x2F;ingress.yaml</span><br></pre></td></tr></table></figure>

<h3 id="web界面管理"><a href="#web界面管理" class="headerlink" title="web界面管理"></a>web界面管理</h3><p><a href="http://km.od.com/" target="_blank" rel="noopener">http://km.od.com/</a></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfmyhj8ku6j31cg0h6q4m.jpg" alt="kafka-manager展示界面"></p>
<p>添加集群</p>
<p>名称：kafka-od,     地址：zk1.od.com:2181</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfmyobsqnzj31ey0lgtag.jpg" alt="添加集群"></p>
<p>查看集群kafka-od信息</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfmys345e1j31he0kmwgc.jpg" alt="集群kafka-od信息"></p>
<h2 id="部署filebeat"><a href="#部署filebeat" class="headerlink" title="部署filebeat"></a>部署filebeat</h2><h3 id="下载镜像-二选一"><a href="#下载镜像-二选一" class="headerlink" title="下载镜像(二选一)"></a>下载镜像(二选一)</h3><blockquote>
<p>github地址：<a href="https://github.com/AliyunContainerService/log-pilot" target="_blank" rel="noopener">https://github.com/AliyunContainerService/log-pilot</a> </p>
<p>log-pilot官方介绍：<a href="https://yq.aliyun.com/articles/674327" target="_blank" rel="noopener">https://yq.aliyun.com/articles/674327</a> </p>
<p>log-pilot官方搭建：<a href="https://yq.aliyun.com/articles/674361?spm=a2c4e.11153940.0.0.21ae21c3mTKwWS" target="_blank" rel="noopener">https://yq.aliyun.com/articles/674361?spm=a2c4e.11153940.0.0.21ae21c3mTKwWS</a> </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker pull registry.cn-hangzhou.aliyuncs.com&#x2F;acs&#x2F;log-pilot:0.9.7-filebeat</span><br><span class="line">docker tag 10a688e1229a harbor.od.com&#x2F;public&#x2F;log-pilot:0.9.7-filebeat</span><br><span class="line">docker push harbor.od.com&#x2F;public&#x2F;log-pilot:0.9.7-filebeat</span><br></pre></td></tr></table></figure>

<h3 id="自定义镜像-推荐，二选一"><a href="#自定义镜像-推荐，二选一" class="headerlink" title="自定义镜像(推荐，二选一)"></a>自定义镜像(推荐，二选一)</h3><p>修改log-pilot源码使其可以收集多行日志(以日期开头，刑如2020-02-29)</p>
<h4 id="拉取master的代码"><a href="#拉取master的代码" class="headerlink" title="拉取master的代码"></a>拉取master的代码</h4><p>一开始用的分支v0.9.5，但是报错了，没出结果</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;data&#x2F;soft&#x2F;docker</span><br><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;AliyunContainerService&#x2F;log-pilot.git</span><br><span class="line">cd log-pilot</span><br><span class="line">git tag</span><br><span class="line"># git checkout v0.9.5  #指定v0.9.5这个版本</span><br></pre></td></tr></table></figure>

<h4 id="修改filebeat模板"><a href="#修改filebeat模板" class="headerlink" title="修改filebeat模板"></a>修改filebeat模板</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@wang-200 log-pilot]# vim assets&#x2F;filebeat&#x2F;filebeat.tpl</span><br><span class="line"></span><br><span class="line">&#123;&#123;range .configList&#125;&#125;</span><br><span class="line">- type: log</span><br><span class="line">  enabled: true</span><br><span class="line">  paths:</span><br><span class="line">      - &#123;&#123; .HostDir &#125;&#125;&#x2F;&#123;&#123; .File &#125;&#125;</span><br><span class="line">  multiline.pattern: &#39;^[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]&#39; #新增正则条件，以日期开头</span><br><span class="line">  multiline.negate: true                                           #新增</span><br><span class="line">  multiline.match: after                                           #新增</span><br><span class="line">  multiline.max_lines: 10000                                       #新增</span><br><span class="line">  scan_frequency: 10s</span><br><span class="line">  fields_under_root: true</span><br><span class="line">  &#123;&#123;if .Stdout&#125;&#125;</span><br><span class="line">  docker-json: true</span><br><span class="line">  &#123;&#123;end&#125;&#125;</span><br><span class="line">  &#123;&#123;if eq .Format &quot;json&quot;&#125;&#125;</span><br><span class="line">  json.keys_under_root: true</span><br><span class="line">  &#123;&#123;end&#125;&#125;</span><br><span class="line">  fields:</span><br><span class="line">      &#123;&#123;range $key, $value :&#x3D; .Tags&#125;&#125;</span><br><span class="line">      &#123;&#123; $key &#125;&#125;: &#123;&#123; $value &#125;&#125;</span><br><span class="line">      &#123;&#123;end&#125;&#125;</span><br><span class="line">      &#123;&#123;range $key, $value :&#x3D; $.container&#125;&#125;</span><br><span class="line">      &#123;&#123; $key &#125;&#125;: &#123;&#123; $value &#125;&#125;</span><br><span class="line">      &#123;&#123;end&#125;&#125;</span><br><span class="line">  tail_files: false</span><br><span class="line">  close_inactive: 2h</span><br><span class="line">  close_eof: false</span><br><span class="line">  close_removed: true</span><br><span class="line">  clean_removed: true</span><br><span class="line">  close_renamed: false</span><br><span class="line"></span><br><span class="line">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sed -i &quot;s&amp;log-pilot:latest&amp;harbor.od.com&#x2F;infra&#x2F;log-pilot:v1.0.1-filebeat&amp;&quot; build-image.sh</span><br><span class="line"># sed -i &quot;s&amp;apk update&amp;sed -i &#39;s&#x2F;dl-cdn.alpinelinux.org&#x2F;mirrors.aliyun.com&#x2F;g&#39; &#x2F;etc&#x2F;apk&#x2F;repositories \&amp;\&amp; apk update&amp;&quot; Dockerfile.filebeat </span><br><span class="line">.&#x2F;build-image.sh</span><br><span class="line">docker push harbor.od.com&#x2F;infra&#x2F;log-pilot:v1.0.1-filebeat</span><br><span class="line"></span><br><span class="line">kubectl create secret docker-registry harbor --docker-server&#x3D;harbor.od.com --docker-username&#x3D;harbor --docker-password&#x3D;Harbo12345 -n kube-system</span><br></pre></td></tr></table></figure>



<h3 id="配置资源清单"><a href="#配置资源清单" class="headerlink" title="配置资源清单"></a>配置资源清单</h3><p>创建文件夹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir &#x2F;data&#x2F;k8s&#x2F;yaml&#x2F;log-pilot</span><br></pre></td></tr></table></figure>

<p><strong>ds.yaml</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; &#x2F;data&#x2F;k8s&#x2F;yaml&#x2F;log-pilot&#x2F;ds.yaml</span><br><span class="line">---</span><br><span class="line">apiVersion: extensions&#x2F;v1beta1</span><br><span class="line">kind: DaemonSet</span><br><span class="line">metadata:</span><br><span class="line">  name: log-pilot</span><br><span class="line">  labels:</span><br><span class="line">    app: log-pilot</span><br><span class="line">  # 设置期望部署的namespace</span><br><span class="line">  namespace: kube-system</span><br><span class="line">spec:</span><br><span class="line">  updateStrategy:</span><br><span class="line">    type: RollingUpdate</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: log-pilot</span><br><span class="line">      annotations:</span><br><span class="line">        scheduler.alpha.kubernetes.io&#x2F;critical-pod: &#39;&#39;</span><br><span class="line">    spec:</span><br><span class="line">      # 是否允许部署到Master节点上</span><br><span class="line">      tolerations:</span><br><span class="line">      - key: node-role.kubernetes.io&#x2F;master</span><br><span class="line">        effect: NoSchedule</span><br><span class="line">      imagePullSecrets:</span><br><span class="line">      - name: harbor</span><br><span class="line">      containers:</span><br><span class="line">      - name: log-pilot</span><br><span class="line">        # 版本请参考https:&#x2F;&#x2F;github.com&#x2F;AliyunContainerService&#x2F;log-pilot&#x2F;releases</span><br><span class="line">        image: harbor.od.com&#x2F;infra&#x2F;log-pilot:v1.0.1-filebeat</span><br><span class="line">        resources:</span><br><span class="line">          limits:</span><br><span class="line">            memory: 500Mi</span><br><span class="line">          requests:</span><br><span class="line">            cpu: 200m</span><br><span class="line">            memory: 200Mi</span><br><span class="line">        env:</span><br><span class="line">          - name: &quot;NODE_NAME&quot;</span><br><span class="line">            valueFrom:</span><br><span class="line">              fieldRef:</span><br><span class="line">                fieldPath: spec.nodeName</span><br><span class="line">          - name: &quot;LOGGING_OUTPUT&quot;</span><br><span class="line">            value: &quot;kafka&quot;</span><br><span class="line">          - name: &quot;KAFKA_BROKERS&quot;</span><br><span class="line">            value: &quot;192.168.70.11:9092&quot;</span><br><span class="line">          - name: &quot;NODE_NAME&quot;</span><br><span class="line">            valueFrom:</span><br><span class="line">              fieldRef:</span><br><span class="line">                fieldPath: spec.nodeName</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: sock</span><br><span class="line">          mountPath: &#x2F;var&#x2F;run&#x2F;docker.sock</span><br><span class="line">        - name: root</span><br><span class="line">          mountPath: &#x2F;host</span><br><span class="line">          readOnly: true</span><br><span class="line">        - name: varlib</span><br><span class="line">          mountPath: &#x2F;var&#x2F;lib&#x2F;filebeat</span><br><span class="line">        - name: varlog</span><br><span class="line">          mountPath: &#x2F;var&#x2F;log&#x2F;filebeat</span><br><span class="line">        - name: localtime</span><br><span class="line">          mountPath: &#x2F;etc&#x2F;localtime</span><br><span class="line">          readOnly: true</span><br><span class="line">        livenessProbe:</span><br><span class="line">          failureThreshold: 3</span><br><span class="line">          exec:</span><br><span class="line">            command:</span><br><span class="line">            - &#x2F;pilot&#x2F;healthz</span><br><span class="line">          initialDelaySeconds: 10</span><br><span class="line">          periodSeconds: 10</span><br><span class="line">          successThreshold: 1</span><br><span class="line">          timeoutSeconds: 2</span><br><span class="line">        securityContext:</span><br><span class="line">          capabilities:</span><br><span class="line">            add:</span><br><span class="line">            - SYS_ADMIN</span><br><span class="line">      terminationGracePeriodSeconds: 30</span><br><span class="line">      volumes:</span><br><span class="line">      - name: sock</span><br><span class="line">        hostPath:</span><br><span class="line">          path: &#x2F;var&#x2F;run&#x2F;docker.sock</span><br><span class="line">      - name: root</span><br><span class="line">        hostPath:</span><br><span class="line">          path: &#x2F;</span><br><span class="line">      - name: varlib</span><br><span class="line">        hostPath:</span><br><span class="line">          path: &#x2F;var&#x2F;lib&#x2F;filebeat</span><br><span class="line">          type: DirectoryOrCreate</span><br><span class="line">      - name: varlog</span><br><span class="line">        hostPath:</span><br><span class="line">          path: &#x2F;var&#x2F;log&#x2F;filebeat</span><br><span class="line">          type: DirectoryOrCreate</span><br><span class="line">      - name: localtime</span><br><span class="line">        hostPath:</span><br><span class="line">          path: &#x2F;etc&#x2F;localtime</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h3 id="执行资源配置清单"><a href="#执行资源配置清单" class="headerlink" title="执行资源配置清单"></a>执行资源配置清单</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kubectl apply -f &#x2F;data&#x2F;k8s&#x2F;yaml&#x2F;log-pilot&#x2F;ds.yaml</span><br></pre></td></tr></table></figure>

<h3 id="收集服务日志"><a href="#收集服务日志" class="headerlink" title="收集服务日志"></a>收集服务日志</h3><p>在dubbo-demo-consumer的deploy.yaml 添加环境变量</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@wang-200 yaml]# vim test&#x2F;dubbo-demo-consumer&#x2F;deploy.yaml </span><br><span class="line">        env:</span><br><span class="line">        - name: aliyun_logs_k8s-out  #当然如果你不想使用aliyun这个关键字，Log-Pilot 也提供了环境变量 PILOT_LOG_PREFIX可以指定自己的声明式日志配置前缀，比如 PILOT_LOG_PREFIX: &quot;aliyun,custom&quot;，最好是和官方一致，省去多余的配置</span><br><span class="line">          value: &quot;stdout&quot;                 #需要收集的日志路径</span><br><span class="line">        - name: aliyun_logs_k8s-out_tags  #定义一个tag</span><br><span class="line">          value: &quot;topic&#x3D;k8s-fb-test-out&quot;  #kafka topic的名字，这个定义是关键，不定义这个，日志是无法输出到kafka内的         </span><br><span class="line"></span><br><span class="line">[root@wang-200 yaml]# kubectl apply -f test&#x2F;dubbo-demo-consumer&#x2F;deploy.yaml</span><br></pre></td></tr></table></figure>

<p><strong>使用Podpreset收集日志(有兴趣自己研究)</strong></p>
<h3 id="验证Kafka"><a href="#验证Kafka" class="headerlink" title="验证Kafka"></a>验证Kafka</h3><p>通过kafka-manager查看索引  <a href="http://km.od.com/clusters/kafka-od/topics" target="_blank" rel="noopener">http://km.od.com/clusters/kafka-od/topics</a></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfnghhmjcwj31q60hq40z.jpg" alt="索引k8s-fb-tset-out注册成功"></p>
<h2 id="部署logstash"><a href="#部署logstash" class="headerlink" title="部署logstash"></a>部署logstash</h2><h3 id="准备镜像-1"><a href="#准备镜像-1" class="headerlink" title="准备镜像"></a>准备镜像</h3><p>在运维主机拉取镜像</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker pull logstash:6.8.3</span><br><span class="line">docker tag 972bf55ad27b harbor.od.com&#x2F;infra&#x2F;logstash:v6.8.3</span><br><span class="line">docker push harbor.od.com&#x2F;infra&#x2F;logstash:v6.8.3</span><br></pre></td></tr></table></figure>

<h3 id="准备配置文件"><a href="#准备配置文件" class="headerlink" title="准备配置文件"></a>准备配置文件</h3><p>在运维主机创建文件夹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@wang-200 ~]# mkdir &#x2F;etc&#x2F;logstash&#x2F;</span><br></pre></td></tr></table></figure>

<p>准备测试环境配置文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; &#x2F;etc&#x2F;logstash&#x2F;logstash-test.conf</span><br><span class="line">input &#123;</span><br><span class="line">  kafka &#123;</span><br><span class="line">    bootstrap_servers &#x3D;&gt; &quot;192.168.70.11:9092&quot;</span><br><span class="line">    client_id &#x3D;&gt; &quot;192.168.70.200&quot;</span><br><span class="line">    consumer_threads &#x3D;&gt; 4</span><br><span class="line">    group_id &#x3D;&gt; &quot;k8s_test&quot;               # 为test组</span><br><span class="line">    topics_pattern &#x3D;&gt; &quot;k8s-fb-test-.*&quot;   # 只收集k8s-fb-test开头的topics</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">  json &#123;</span><br><span class="line">    source &#x3D;&gt; &quot;message&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  elasticsearch &#123;</span><br><span class="line">    hosts &#x3D;&gt; [&quot;192.168.70.12:9200&quot;]</span><br><span class="line">    index &#x3D;&gt; &quot;k8s-test-%&#123;+YYYY.MM.DD&#125;&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>准备生产环境配置文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; &#x2F;etc&#x2F;logstash&#x2F;logstash-prod.conf</span><br><span class="line">input &#123;</span><br><span class="line">  kafka &#123;</span><br><span class="line">    bootstrap_servers &#x3D;&gt; &quot;192.168.70.11:9092&quot;</span><br><span class="line">    client_id &#x3D;&gt; &quot;192.168.70.200&quot;</span><br><span class="line">    consumer_threads &#x3D;&gt; 4</span><br><span class="line">    group_id &#x3D;&gt; &quot;k8s_prod&quot;                   </span><br><span class="line">    topics_pattern &#x3D;&gt; &quot;k8s-fb-prod-.*&quot; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">  json &#123;</span><br><span class="line">    source &#x3D;&gt; &quot;message&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  elasticsearch &#123;</span><br><span class="line">    hosts &#x3D;&gt; [&quot;192.168.70.12:9200&quot;]</span><br><span class="line">    index &#x3D;&gt; “k8s-prod-%&#123;+YYYY.MM.DD&#125;&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h3 id="测试logstash启动"><a href="#测试logstash启动" class="headerlink" title="测试logstash启动"></a>测试logstash启动</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@wang-200 ~]# docker run -d --restart&#x3D;always --name logstash-test -v &#x2F;etc&#x2F;logstash:&#x2F;etc&#x2F;logstash  harbor.od.com&#x2F;infra&#x2F;logstash:v6.8.3 -f &#x2F;etc&#x2F;logstash&#x2F;logstash-test.conf</span><br><span class="line">[root@wang-200 ~]# docker ps -a|grep logstash</span><br><span class="line">53a32e867f2e        harbor.od.com&#x2F;infra&#x2F;logstash:v6.8.3                 &quot;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;dock…&quot;   10 seconds ago      Up 9 seconds           5044&#x2F;tcp, 9600&#x2F;tcp          logstash-test</span><br></pre></td></tr></table></figure>

<h3 id="查看es是否接收数据"><a href="#查看es是否接收数据" class="headerlink" title="查看es是否接收数据"></a>查看es是否接收数据</h3><p>要等一会儿，不要着急，等它多产生一点数据。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl http:&#x2F;&#x2F;192.168.70.12:9200&#x2F;_cat&#x2F;indices?v</span><br></pre></td></tr></table></figure>

<h3 id="生产logstash启动"><a href="#生产logstash启动" class="headerlink" title="生产logstash启动"></a>生产logstash启动</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@wang-200 ~]# docker run -d --restart&#x3D;always --name logstash-prod -v &#x2F;etc&#x2F;logstash:&#x2F;etc&#x2F;logstash  harbor.od.com&#x2F;infra&#x2F;logstash:v6.8.3 -f &#x2F;etc&#x2F;logstash&#x2F;logstash-prod.conf</span><br></pre></td></tr></table></figure>



<h2 id="部署kibana"><a href="#部署kibana" class="headerlink" title="部署kibana"></a>部署kibana</h2><h3 id="准备镜像-2"><a href="#准备镜像-2" class="headerlink" title="准备镜像"></a>准备镜像</h3><p>运维主机wang-200.host.com上</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker pull kibana:6.8.6</span><br><span class="line">docker tag adfab5632ef4 harbor.od.com&#x2F;infra&#x2F;kibana:v6.8.6</span><br><span class="line">docker push harbor.od.com&#x2F;infra&#x2F;kibana:v6.8.6</span><br></pre></td></tr></table></figure>



<h3 id="准备资源配置清单-1"><a href="#准备资源配置清单-1" class="headerlink" title="准备资源配置清单"></a>准备资源配置清单</h3><p>创建资源配置清单文件夹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir &#x2F;data&#x2F;k8s&#x2F;yaml&#x2F;kibana</span><br><span class="line">cd &#x2F;data&#x2F;k8s&#x2F;yaml&#x2F;kibana</span><br></pre></td></tr></table></figure>

<p>deploy.yaml</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; &#x2F;data&#x2F;k8s&#x2F;yaml&#x2F;kibana&#x2F;deploy.yaml</span><br><span class="line">kind: Deployment</span><br><span class="line">apiVersion: extensions&#x2F;v1beta1</span><br><span class="line">metadata:</span><br><span class="line">  name: kibana</span><br><span class="line">  namespace: infra</span><br><span class="line">  labels: </span><br><span class="line">    name: kibana</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels: </span><br><span class="line">      name: kibana</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels: </span><br><span class="line">        app: kibana</span><br><span class="line">        name: kibana</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: kibana</span><br><span class="line">        image: harbor.od.com&#x2F;infra&#x2F;kibana:v6.8.6</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 5601</span><br><span class="line">          protocol: TCP</span><br><span class="line">        env:</span><br><span class="line">        - name: ELASTICSEARCH_URL</span><br><span class="line">          value: http:&#x2F;&#x2F;192.168.70.12:9200</span><br><span class="line">      imagePullSecrets:</span><br><span class="line">      - name: harbor</span><br><span class="line">      securityContext: </span><br><span class="line">        runAsUser: 0</span><br><span class="line">  strategy:</span><br><span class="line">    type: RollingUpdate</span><br><span class="line">    rollingUpdate: </span><br><span class="line">      maxUnavailable: 1</span><br><span class="line">      maxSurge: 1</span><br><span class="line">  revisionHistoryLimit: 7</span><br><span class="line">  progressDeadlineSeconds: 600</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>svc.yaml</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; &#x2F;data&#x2F;k8s&#x2F;yaml&#x2F;kibana&#x2F;svc.yaml</span><br><span class="line">kind: Service</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata: </span><br><span class="line">  name: kibana</span><br><span class="line">  namespace: infra</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - protocol: TCP</span><br><span class="line">    port: 5601</span><br><span class="line">    targetPort: 5601</span><br><span class="line">  selector: </span><br><span class="line">    app: kibana</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>ingress.yaml</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; &#x2F;data&#x2F;k8s&#x2F;yaml&#x2F;kibana&#x2F;ingress.yaml</span><br><span class="line">kind: Ingress</span><br><span class="line">apiVersion: extensions&#x2F;v1beta1</span><br><span class="line">metadata: </span><br><span class="line">  name: kibana</span><br><span class="line">  namespace: infra</span><br><span class="line">spec:</span><br><span class="line">  rules:</span><br><span class="line">  - host: kibana.od.com</span><br><span class="line">    http:</span><br><span class="line">      paths:</span><br><span class="line">      - path: &#x2F;</span><br><span class="line">        backend: </span><br><span class="line">          serviceName: kibana</span><br><span class="line">          servicePort: 5601</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h3 id="执行资源配置清单-1"><a href="#执行资源配置清单-1" class="headerlink" title="执行资源配置清单"></a>执行资源配置清单</h3><p>执行命令</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kubectl apply -f http:&#x2F;&#x2F;doc.k8s.od.com&#x2F;yaml&#x2F;kibana&#x2F;deploy.yaml</span><br><span class="line">kubectl apply -f http:&#x2F;&#x2F;doc.k8s.od.com&#x2F;yaml&#x2F;kibana&#x2F;svc.yaml</span><br><span class="line">kubectl apply -f http:&#x2F;&#x2F;doc.k8s.od.com&#x2F;yaml&#x2F;kibana&#x2F;ingress.yaml</span><br></pre></td></tr></table></figure>

<h3 id="web展示"><a href="#web展示" class="headerlink" title="web展示"></a>web展示</h3><p><a href="http://kibana.od.com/" target="_blank" rel="noopener">http://kibana.od.com/</a></p>
<p><strong>添加索引k8s-test-*</strong></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfngjil5q0j32180qa7c9.jpg" alt="添加索引k8s-test-*"></p>
<p><strong>elasticsearch收集的数据</strong></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfngkq5zgsj321o0twaka.jpg" alt="elasticsearch收集的数据"></p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">会跳的小蚂蚁</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://wang.ikongjian.com/2020/06/10/%E4%BA%94%E3%80%81%E7%94%9F%E6%80%81-elk%E6%94%B6%E9%9B%86%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97/">http://wang.ikongjian.com/2020/06/10/%E4%BA%94%E3%80%81%E7%94%9F%E6%80%81-elk%E6%94%B6%E9%9B%86%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://wang.ikongjian.com" target="_blank">蚂蚁博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/kubernetes/">kubernetes</a><a class="post-meta__tags" href="/tags/%E8%80%81%E7%94%B7%E5%AD%A9/">老男孩</a><a class="post-meta__tags" href="/tags/%E5%AE%9E%E6%88%98%E4%BA%A4%E4%BB%98/">实战交付</a></div><div class="post_share"><div class="social-share" data-image="/img/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> donate<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="/img/alipay.jpg" alt="支付宝"/><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><div class="post-ad"><ins class="adsbygoogle" style="display:block" data-ad-format="fluid" data-ad-layout-key="xxxxxxxxxxxx" data-ad-client="ca-pub-xxxxxxxxxx" data-ad-slot="xxxxxxxxxx"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/06/16/%E4%B8%80%E3%80%81%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6-nexus%E7%A7%81%E6%9C%8D/"><img class="prev_cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">一、常用软件-nexus私服</div></div></a></div><div class="next-post pull_right"><a href="/2020/06/09/%E5%9B%9B%E3%80%81%E7%94%9F%E6%80%81-prometheus%E7%B3%BB%E7%BB%9F%E7%9B%91%E6%8E%A7/"><img class="next_cover" src="/img/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">四、生态-prometheus系统监控</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/05/28/0、交付-域名集合/" title="0、交付-域名集合"><img class="relatedPosts_cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-28</div><div class="relatedPosts_title">0、交付-域名集合</div></div></a></div><div class="relatedPosts_item"><a href="/2020/06/05/二、交付-使用blue-ocean流水线构建/" title="二、交付-使用blue ocean流水线构建"><img class="relatedPosts_cover" src="/img/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-06-05</div><div class="relatedPosts_title">二、交付-使用blue ocean流水线构建</div></div></a></div><div class="relatedPosts_item"><a href="/2020/06/08/三、交付-使用apollo配置中心/" title="三、交付-使用apollo配置中心"><img class="relatedPosts_cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-06-08</div><div class="relatedPosts_title">三、交付-使用apollo配置中心</div></div></a></div><div class="relatedPosts_item"><a href="/2020/06/05/一、交付-基础环境准备/" title="一、交付-基础环境准备"><img class="relatedPosts_cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-06-05</div><div class="relatedPosts_title">一、交付-基础环境准备</div></div></a></div><div class="relatedPosts_item"><a href="/2020/06/09/四、生态-prometheus系统监控/" title="四、生态-prometheus系统监控"><img class="relatedPosts_cover" src="/img/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-06-09</div><div class="relatedPosts_title">四、生态-prometheus系统监控</div></div></a></div><div class="relatedPosts_item"><a href="/2020/05/30/二、k8s-前期环境准备/" title="二、k8s-前期环境准备"><img class="relatedPosts_cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-30</div><div class="relatedPosts_title">二、k8s-前期环境准备</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var requestSetting = function (from,set) {
  var from = from
  var setting = set.split(',').filter(function(item){
  return from.indexOf(item) > -1
  });
  setting = setting.length == 0 ? from :setting;
  return setting
}

var guestInfo = requestSetting(['nick','mail','link'],'nick,mail,link')
var requiredFields = requestSetting(['nick','mail','link'],'nick,mail')

window.valine = new Valine({
  el:'#vcomment',
  appId: '3trHicwpGcV9ectvS8IUTPyA-gzGzoHsz',
  appKey: 'O89QU06amIo1zHhNLV9BMxU7',
  notify: false,
  verify: false,
  placeholder: 'Please leave your footprints',
  avatar: 'monsterid',
  meta: guestInfo,
  pageSize: '10',
  lang: 'en',
  recordIP: false,
  serverURLs: '',
  emojiCDN: '',
  emojiMaps: "",
  enableQQ: false,
  requiredFields: requiredFields
});</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By 会跳的小蚂蚁</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://jerryc.me/" target="_blank" rel="noopener">blog</a>!</div><div class="icp"><a><img class="icp-icon" src="/img/icp.png"/><span>待添加</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script defer id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@3/instantpage.min.js" type="module"></script><script src="/js/search/local-search.js"></script></body></html>