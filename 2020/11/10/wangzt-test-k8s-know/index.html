<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>wangzt/test/k8s-know | 蚂蚁博客</title><meta name="description" content="其他知识 lvs, lvm, linux启动顺序，内核调优， 阿里云主机服务网络迁移dubbo是什么？springcloud了解多少Spring Cloud是一个微服务框架的规范，注意，只是规范，他不是任何具体的框架。 它规定大概要有以下几种功能。  服务的注册与发现 负载均衡 服务熔断和限流 智能路由 控制总线 链路监控  Spring Cloud和Spring boot的关系与其说他们有什么关"><meta name="keywords" content="k8s"><meta name="author" content="会跳的小蚂蚁"><meta name="copyright" content="会跳的小蚂蚁"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="wangzt/test/k8s-know"><meta name="twitter:description" content="其他知识 lvs, lvm, linux启动顺序，内核调优， 阿里云主机服务网络迁移dubbo是什么？springcloud了解多少Spring Cloud是一个微服务框架的规范，注意，只是规范，他不是任何具体的框架。 它规定大概要有以下几种功能。  服务的注册与发现 负载均衡 服务熔断和限流 智能路由 控制总线 链路监控  Spring Cloud和Spring boot的关系与其说他们有什么关"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><meta property="og:type" content="article"><meta property="og:title" content="wangzt/test/k8s-know"><meta property="og:url" content="http://wang.ikongjian.com/2020/11/10/wangzt-test-k8s-know/"><meta property="og:site_name" content="蚂蚁博客"><meta property="og:description" content="其他知识 lvs, lvm, linux启动顺序，内核调优， 阿里云主机服务网络迁移dubbo是什么？springcloud了解多少Spring Cloud是一个微服务框架的规范，注意，只是规范，他不是任何具体的框架。 它规定大概要有以下几种功能。  服务的注册与发现 负载均衡 服务熔断和限流 智能路由 控制总线 链路监控  Spring Cloud和Spring boot的关系与其说他们有什么关"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><meta property="article:published_time" content="2020-11-10T07:07:19.270Z"><meta property="article:modified_time" content="2020-11-10T07:07:19.191Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://wang.ikongjian.com/2020/11/10/wangzt-test-k8s-know/"><link rel="prev" title="linux-tmp" href="http://wang.ikongjian.com/2021/01/01/linux-tmp/"><link rel="next" title="数据盘存储" href="http://wang.ikongjian.com/2020/11/03/%E6%95%B0%E6%8D%AE%E7%9B%98%E5%AD%98%E5%82%A8/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: true
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">91</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">48</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">40</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/2020/07/01/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#其他知识"><span class="toc-number">1.</span> <span class="toc-text">其他知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#阿里云主机服务网络迁移"><span class="toc-number">1.1.</span> <span class="toc-text">阿里云主机服务网络迁移</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dubbo是什么？springcloud了解多少"><span class="toc-number">1.2.</span> <span class="toc-text">dubbo是什么？springcloud了解多少</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Cloud和Spring-boot的关系"><span class="toc-number">1.2.1.</span> <span class="toc-text">Spring Cloud和Spring boot的关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Cloud和dubbo的关系"><span class="toc-number">1.2.2.</span> <span class="toc-text">Spring Cloud和dubbo的关系</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用nginx时，后段服务挂掉怎么办"><span class="toc-number">1.3.</span> <span class="toc-text">使用nginx时，后段服务挂掉怎么办</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#filebeat服务故障时，如果保证日志不丢失"><span class="toc-number">1.4.</span> <span class="toc-text">filebeat服务故障时，如果保证日志不丢失</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kafka的实现原理"><span class="toc-number">1.5.</span> <span class="toc-text">kafka的实现原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#prometheus的相关原理"><span class="toc-number">1.6.</span> <span class="toc-text">prometheus的相关原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker的网络分几种"><span class="toc-number">1.7.</span> <span class="toc-text">docker的网络分几种</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jenkins-pipeline"><span class="toc-number">1.8.</span> <span class="toc-text">Jenkins pipeline</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#k8s的原理"><span class="toc-number">2.</span> <span class="toc-text">k8s的原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#k8s有哪些组件"><span class="toc-number">2.1.</span> <span class="toc-text">k8s有哪些组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#master"><span class="toc-number">2.1.1.</span> <span class="toc-text">master</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#node"><span class="toc-number">2.1.2.</span> <span class="toc-text">node</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#addons"><span class="toc-number">2.1.3.</span> <span class="toc-text">addons</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#你在部署k8s集群时，都遇到过哪些问题，你是怎么解决的"><span class="toc-number">2.2.</span> <span class="toc-text">你在部署k8s集群时，都遇到过哪些问题，你是怎么解决的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#你在使用k8s集群时，都遇到过哪些问题，你是怎么解决的"><span class="toc-number">2.3.</span> <span class="toc-text">你在使用k8s集群时，都遇到过哪些问题，你是怎么解决的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#在k8s里部署过有状态的应用吗"><span class="toc-number">2.4.</span> <span class="toc-text">在k8s里部署过有状态的应用吗</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#阿里云k8s托管版的架构"><span class="toc-number">2.5.</span> <span class="toc-text">阿里云k8s托管版的架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kubeadm创建k8s集群过程"><span class="toc-number">2.6.</span> <span class="toc-text">kubeadm创建k8s集群过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#k8s组件的升级顺序"><span class="toc-number">2.7.</span> <span class="toc-text">k8s组件的升级顺序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#参考文档"><span class="toc-number">2.7.1.</span> <span class="toc-text">参考文档</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#k8s如何下线一个节点"><span class="toc-number">2.8.</span> <span class="toc-text">k8s如何下线一个节点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#参考文档-1"><span class="toc-number">2.8.1.</span> <span class="toc-text">参考文档</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#etcd的高可用配置和原理"><span class="toc-number">2.9.</span> <span class="toc-text">etcd的高可用配置和原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kube-apiserver是如何实现高可用的"><span class="toc-number">2.10.</span> <span class="toc-text">kube-apiserver是如何实现高可用的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pod的IP地址是谁分配的"><span class="toc-number">2.11.</span> <span class="toc-text">pod的IP地址是谁分配的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#configmap怎么使用，支持热更新吗"><span class="toc-number">2.12.</span> <span class="toc-text">configmap怎么使用，支持热更新吗</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pod生命周期"><span class="toc-number">2.13.</span> <span class="toc-text">pod生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#参考文档-2"><span class="toc-number">2.13.1.</span> <span class="toc-text">参考文档</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#描述一个pod的创建过程"><span class="toc-number">2.14.</span> <span class="toc-text">描述一个pod的创建过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#参考文档-3"><span class="toc-number">2.14.1.</span> <span class="toc-text">参考文档</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如果服务是长连接，如何保证pod升级时，服务不受影响"><span class="toc-number">2.15.</span> <span class="toc-text">如果服务是长连接，如何保证pod升级时，服务不受影响</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何缩小容器的镜像"><span class="toc-number">2.16.</span> <span class="toc-text">如何缩小容器的镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#对k8s做了哪些监控？有对服务的信息做分析吗"><span class="toc-number">2.17.</span> <span class="toc-text">对k8s做了哪些监控？有对服务的信息做分析吗</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pod出现异常时，怎么排查问题"><span class="toc-number">2.18.</span> <span class="toc-text">Pod出现异常时，怎么排查问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pod的优先级"><span class="toc-number">2.19.</span> <span class="toc-text">pod的优先级</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#QoS（Quality-of-Service，服务质量）-模型主要分为："><span class="toc-number">2.19.1.</span> <span class="toc-text">QoS（Quality of Service，服务质量） 模型主要分为：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#通过PriorityClass设置-Pod-优先级"><span class="toc-number">2.19.2.</span> <span class="toc-text">通过PriorityClass设置 Pod 优先级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#参考文档-4"><span class="toc-number">2.19.3.</span> <span class="toc-text">参考文档</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pod发生驱逐的情况"><span class="toc-number">2.20.</span> <span class="toc-text">pod发生驱逐的情况</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pod原地升级"><span class="toc-number">2.21.</span> <span class="toc-text">pod原地升级</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#参考文档-5"><span class="toc-number">2.21.1.</span> <span class="toc-text">参考文档</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#k8s网络"><span class="toc-number">3.</span> <span class="toc-text">k8s网络</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#service"><span class="toc-number">3.1.</span> <span class="toc-text">service</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#参考文档-6"><span class="toc-number">3.1.1.</span> <span class="toc-text">参考文档</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#“网络栈”有哪些组件"><span class="toc-number">3.2.</span> <span class="toc-text">“网络栈”有哪些组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flannel的几种网络模式"><span class="toc-number">3.3.</span> <span class="toc-text">flannel的几种网络模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#service的实现机制"><span class="toc-number">3.4.</span> <span class="toc-text">service的实现机制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#iptables和ipvs区别"><span class="toc-number">3.5.</span> <span class="toc-text">iptables和ipvs区别</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-总结"><span class="toc-number">3.5.1.</span> <span class="toc-text">3.4 总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#参考文档-7"><span class="toc-number">3.5.2.</span> <span class="toc-text">参考文档</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#iptables和ipvs实现过程"><span class="toc-number">3.6.</span> <span class="toc-text">iptables和ipvs实现过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ipvs实现过程"><span class="toc-number">3.6.1.</span> <span class="toc-text">ipvs实现过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#service地址可以ping通吗"><span class="toc-number">3.7.</span> <span class="toc-text">service地址可以ping通吗</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#k8s服务之间是如何调用的"><span class="toc-number">3.8.</span> <span class="toc-text">k8s服务之间是如何调用的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#外部服务访问k8s内部pod的几种方式"><span class="toc-number">3.9.</span> <span class="toc-text">外部服务访问k8s内部pod的几种方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#参考文档："><span class="toc-number">3.9.1.</span> <span class="toc-text">参考文档：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kubernetes之Network-Policy"><span class="toc-number">3.10.</span> <span class="toc-text">Kubernetes之Network Policy</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#参考文档-8"><span class="toc-number">3.10.1.</span> <span class="toc-text">参考文档</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Headless-Service-zookeeper"><span class="toc-number">3.11.</span> <span class="toc-text">Headless Service: zookeeper</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">蚂蚁博客</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/2020/07/01/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">wangzt/test/k8s-know</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-11-10 15:07:19"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-11-10</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-11-10 15:07:19"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-11-10</span></time></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">3.3k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 11 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="其他知识"><a href="#其他知识" class="headerlink" title="其他知识"></a>其他知识</h1><p> lvs, lvm, linux启动顺序，内核调优，</p>
<h2 id="阿里云主机服务网络迁移"><a href="#阿里云主机服务网络迁移" class="headerlink" title="阿里云主机服务网络迁移"></a>阿里云主机服务网络迁移</h2><h2 id="dubbo是什么？springcloud了解多少"><a href="#dubbo是什么？springcloud了解多少" class="headerlink" title="dubbo是什么？springcloud了解多少"></a>dubbo是什么？springcloud了解多少</h2><p>Spring Cloud是一个微服务框架的规范，注意，<strong>只是规范，他不是任何具体的框架</strong>。</p>
<p>它规定大概要有以下几种功能。</p>
<ol>
<li>服务的注册与发现</li>
<li>负载均衡</li>
<li>服务熔断和限流</li>
<li>智能路由</li>
<li>控制总线</li>
<li>链路监控</li>
</ol>
<h3 id="Spring-Cloud和Spring-boot的关系"><a href="#Spring-Cloud和Spring-boot的关系" class="headerlink" title="Spring Cloud和Spring boot的关系"></a>Spring Cloud和Spring boot的关系</h3><p>与其说他们有什么关系，不如说他们就没有什么关系。只是现在微服务当道，而实现一个服务最快的办法就是用spring  boot。不然你还要自己搭项目自己找jar包自己搞配置，还有兼容性等情况。那你的服务化进程注定是缓慢的。所以他们之间是没有关系的，只是因为微服务所需要的小应用很多，而spring boot恰恰又是实现小应用最快的方式。</p>
<h3 id="Spring-Cloud和dubbo的关系"><a href="#Spring-Cloud和dubbo的关系" class="headerlink" title="Spring Cloud和dubbo的关系"></a>Spring Cloud和dubbo的关系</h3><p>dubbo是阿里搞得一套框架，是基于RPC调用的，而Spring Cloud  Netflix是基于HTTP的，所以效率上应该dubbo更快（如果你不能理解什么是RPC，当我没说，反正dubbo更快就是了）。但是dubbo的组件不是很齐全，他的很多功能比如服务注册与发现你需要借助于类似zookeeper等组件才能实现，而Spring Cloud Netflix则是提供了一站式解决方案。从使用广度来说，在国内几年前dubbo的使用人数远多于Spring  Cloud的，但是近来Spring Cloud慢慢的有了后来居上的趋势。</p>
<h2 id="使用nginx时，后段服务挂掉怎么办"><a href="#使用nginx时，后段服务挂掉怎么办" class="headerlink" title="使用nginx时，后段服务挂掉怎么办"></a>使用nginx时，后段服务挂掉怎么办</h2><h2 id="filebeat服务故障时，如果保证日志不丢失"><a href="#filebeat服务故障时，如果保证日志不丢失" class="headerlink" title="filebeat服务故障时，如果保证日志不丢失"></a>filebeat服务故障时，如果保证日志不丢失</h2><h2 id="kafka的实现原理"><a href="#kafka的实现原理" class="headerlink" title="kafka的实现原理"></a>kafka的实现原理</h2><h2 id="prometheus的相关原理"><a href="#prometheus的相关原理" class="headerlink" title="prometheus的相关原理"></a>prometheus的相关原理</h2><h2 id="docker的网络分几种"><a href="#docker的网络分几种" class="headerlink" title="docker的网络分几种"></a>docker的网络分几种</h2><ol>
<li>bridge桥接模式：将容器的网络连接到虚拟网桥上（默认模式）。–net=bridge</li>
<li>host主机模式：容器不会虚拟自己的网卡，配置自己的IP，而会使用宿主机的IP地址和端口</li>
<li>container共享容器网络模式：新建的容器和已经存在的容器共享一个网络</li>
<li>none无网络模式：容器拥有自己的Network Namespace, 但是不进行任何的网络设置</li>
</ol>
<h2 id="Jenkins-pipeline"><a href="#Jenkins-pipeline" class="headerlink" title="Jenkins pipeline"></a>Jenkins pipeline</h2><h1 id="k8s的原理"><a href="#k8s的原理" class="headerlink" title="k8s的原理"></a>k8s的原理</h1><h2 id="k8s有哪些组件"><a href="#k8s有哪些组件" class="headerlink" title="k8s有哪些组件"></a>k8s有哪些组件</h2><h3 id="master"><a href="#master" class="headerlink" title="master"></a>master</h3><ul>
<li>etcd：Etcd是用Go编程语言编写的，是一个分布式键值存储，用于协调分布式工作。因此，Etcd存储Kubernetes集群的配置数据，表示在任何给定时间点的集群状态。</li>
<li>kube-apiserver:遵循横向扩展架构，是主节点控制面板的前端。这将公开Kubernetes主节点组件的所有API，并负责在Kubernetes节点和Kubernetes主组件之间建立通信。</li>
<li>kube-controller-manager:多个控制器进程在主节点上运行，但是一起编译为单个进程运行，即Kubernetes控制器管理器。因此，Controller Manager是一个嵌入控制器并执行命名空间创建和垃圾收集的守护程序。它拥有责任并与API服务器通信以管理端点。</li>
<li>kube-scheduler:负责工作节点上工作负载的分配和管理。因此，它根据资源需求选择最合适的节点来运行未调度的pod，并跟踪资源利用率。它确保不在已满的节点上调度工作负载。</li>
</ul>
<h3 id="node"><a href="#node" class="headerlink" title="node"></a>node</h3><ul>
<li>kubelet:</li>
<li>kube-proxy:Kube-proxy可以在每个节点上运行，并且可以跨后端网络服务进行简单的TCP /  UDP数据包转发。基本上，它是一个网络代理，它反映了每个节点上Kubernetes  API中配置的服务。因此，Docker可链接的兼容环境变量提供由代理打开的群集IP和端口。</li>
</ul>
<h3 id="addons"><a href="#addons" class="headerlink" title="addons"></a>addons</h3><ul>
<li>flannel:</li>
<li>CoreDNS:</li>
<li>ingress:</li>
<li>dashboard:</li>
</ul>
<h2 id="你在部署k8s集群时，都遇到过哪些问题，你是怎么解决的"><a href="#你在部署k8s集群时，都遇到过哪些问题，你是怎么解决的" class="headerlink" title="你在部署k8s集群时，都遇到过哪些问题，你是怎么解决的"></a>你在部署k8s集群时，都遇到过哪些问题，你是怎么解决的</h2><p>安装flannal时，subnet配置错误，最后修改的etcd数据</p>
<h2 id="你在使用k8s集群时，都遇到过哪些问题，你是怎么解决的"><a href="#你在使用k8s集群时，都遇到过哪些问题，你是怎么解决的" class="headerlink" title="你在使用k8s集群时，都遇到过哪些问题，你是怎么解决的"></a>你在使用k8s集群时，都遇到过哪些问题，你是怎么解决的</h2><ol>
<li>通过describe pod查看输出信息</li>
<li>通过kubectl logs查看日志信息</li>
<li>通过kubectl exec 查看进程信息</li>
</ol>
<h2 id="在k8s里部署过有状态的应用吗"><a href="#在k8s里部署过有状态的应用吗" class="headerlink" title="在k8s里部署过有状态的应用吗"></a>在k8s里部署过有状态的应用吗</h2><p>部署过zk3.6</p>
<h2 id="阿里云k8s托管版的架构"><a href="#阿里云k8s托管版的架构" class="headerlink" title="阿里云k8s托管版的架构"></a>阿里云k8s托管版的架构</h2><h2 id="kubeadm创建k8s集群过程"><a href="#kubeadm创建k8s集群过程" class="headerlink" title="kubeadm创建k8s集群过程"></a>kubeadm创建k8s集群过程</h2><h2 id="k8s组件的升级顺序"><a href="#k8s组件的升级顺序" class="headerlink" title="k8s组件的升级顺序"></a>k8s组件的升级顺序</h2><p>k8s升级规划：</p>
<ul>
<li>官方建议每次升级不要跨越两个版本，升级顺序为: master，addons，salve。</li>
<li>slave节点的升级是滚动升级，官方建议首先使用<code>kubectl drain</code>驱逐pod之后，然后升级kubelet。</li>
<li>apiserver升级之前需要确保resource version被正常支持。</li>
<li>备份etcd数据库数据。</li>
</ul>
<h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ul>
<li><a href="https://www.cnblogs.com/gaorong/p/11266629.html" target="_blank" rel="noopener">kubernetes集群升级的正确姿势</a></li>
</ul>
<h2 id="k8s如何下线一个节点"><a href="#k8s如何下线一个节点" class="headerlink" title="k8s如何下线一个节点"></a>k8s如何下线一个节点</h2><h3 id="参考文档-1"><a href="#参考文档-1" class="headerlink" title="参考文档"></a>参考文档</h3><ul>
<li><a href="https://kubernetes.io/zh/docs/tasks/administer-cluster/safely-drain-node/" target="_blank" rel="noopener">清空一个节点</a></li>
</ul>
<h2 id="etcd的高可用配置和原理"><a href="#etcd的高可用配置和原理" class="headerlink" title="etcd的高可用配置和原理"></a>etcd的高可用配置和原理</h2><h2 id="kube-apiserver是如何实现高可用的"><a href="#kube-apiserver是如何实现高可用的" class="headerlink" title="kube-apiserver是如何实现高可用的"></a>kube-apiserver是如何实现高可用的</h2><p>keepalive+lvs</p>
<h2 id="pod的IP地址是谁分配的"><a href="#pod的IP地址是谁分配的" class="headerlink" title="pod的IP地址是谁分配的"></a>pod的IP地址是谁分配的</h2><p>分析：k8s的CNI网络插件</p>
<p>kubelet通过CRI接口调用docker, docker启动服务时加载CNI 网络插件flannel时分配IP地址。</p>
<h2 id="configmap怎么使用，支持热更新吗"><a href="#configmap怎么使用，支持热更新吗" class="headerlink" title="configmap怎么使用，支持热更新吗"></a>configmap怎么使用，支持热更新吗</h2><p>configmap热更新分两种情况：</p>
<ul>
<li><p>更新已经在数据卷中使用的 ConfigMap 时，已映射的键最终也会被更新。</p>
</li>
<li><p>使用 ConfigMap 作为 <a href="https://kubernetes.io/zh/docs/concepts/storage/volumes/#using-subpath" target="_blank" rel="noopener">subPath</a> 的数据卷将不会收到 ConfigMap 更新</p>
</li>
</ul>
<h2 id="pod生命周期"><a href="#pod生命周期" class="headerlink" title="pod生命周期"></a>pod生命周期</h2><p>容器的状态有三种：<code>Waiting</code>（等待）、<code>Running</code>（运行中）和 <code>Terminated</code>（已终止）。</p>
<p>pod生命周期有：</p>
<table>
<thead>
<tr>
<th>取值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>Pending</code>（悬决）</td>
<td>Pod 已被 Kubernetes 系统接受，但有一个或者多个容器尚未创建亦未运行。此阶段包括等待 Pod 被调度的时间和通过网络下载镜像的时间，</td>
</tr>
<tr>
<td><code>Running</code>（运行中）</td>
<td>Pod 已经绑定到了某个节点，Pod 中所有的容器都已被创建。至少有一个容器仍在运行，或者正处于启动或重启状态。</td>
</tr>
<tr>
<td><code>Succeeded</code>（成功）</td>
<td>Pod 中的所有容器都已成功终止，并且不会再重启。</td>
</tr>
<tr>
<td><code>Failed</code>（失败）</td>
<td>Pod 中的所有容器都已终止，并且至少有一个容器是因为失败终止。也就是说，容器以非 0 状态退出或者被系统终止。</td>
</tr>
<tr>
<td><code>Unknown</code>（未知）</td>
<td>因为某些原因无法取得 Pod 的状态。这种情况通常是因为与 Pod 所在主机通信失败。</td>
</tr>
</tbody></table>
<p>如果某节点死掉或者与集群中其他节点失联，Kubernetes 会实施一种策略，将失去的节点上运行的所有 Pod 的 <code>phase</code> 设置为 <code>Failed</code>。</p>
<h3 id="参考文档-2"><a href="#参考文档-2" class="headerlink" title="参考文档"></a>参考文档</h3><ul>
<li><a href="https://kubernetes.io/zh/docs/concepts/workloads/pods/pod-lifecycle/#pod-conditions" target="_blank" rel="noopener">Pod 的生命周期</a></li>
</ul>
<h2 id="描述一个pod的创建过程"><a href="#描述一个pod的创建过程" class="headerlink" title="描述一个pod的创建过程"></a>描述一个pod的创建过程</h2><h3 id="参考文档-3"><a href="#参考文档-3" class="headerlink" title="参考文档"></a>参考文档</h3><ul>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzA4MzIwNTc4NQ==&mid=2247484143&idx=1&sn=63552dbb768cf8ec5488575375f07311&chksm=9ffb4919a88cc00f7f411ce4b2cc6dfdb3eb3aa67f05791ba5ffeaac9650dbdeb7c6548ad4e5&mpshare=1&scene=23&srcid=&sharer_sharetime=1579044356619&sharer_shareid=85ecb9201cba173f8c63eaf47b0c5559#rd" target="_blank" rel="noopener">kubectl 创建 Pod 背后到底发生了什么?</a></li>
</ul>
<h2 id="如果服务是长连接，如何保证pod升级时，服务不受影响"><a href="#如果服务是长连接，如何保证pod升级时，服务不受影响" class="headerlink" title="如果服务是长连接，如何保证pod升级时，服务不受影响"></a>如果服务是长连接，如何保证pod升级时，服务不受影响</h2><p>可以有以下几种：</p>
<ol>
<li>设置服务重设机制</li>
<li>设置prestop机制</li>
<li>增加体面终止时间</li>
</ol>
<h2 id="如何缩小容器的镜像"><a href="#如何缩小容器的镜像" class="headerlink" title="如何缩小容器的镜像"></a>如何缩小容器的镜像</h2><p>缩小容器镜像的方法有：</p>
<ul>
<li>使用Alpine基础镜像</li>
<li>服务镜像和基础镜像分离</li>
<li>使用pv挂载数据</li>
</ul>
<h2 id="对k8s做了哪些监控？有对服务的信息做分析吗"><a href="#对k8s做了哪些监控？有对服务的信息做分析吗" class="headerlink" title="对k8s做了哪些监控？有对服务的信息做分析吗"></a>对k8s做了哪些监控？有对服务的信息做分析吗</h2><p>对k8s做了：</p>
<ul>
<li>节点的CPU，内存，磁盘等常用监控</li>
<li>etcd等服务监控</li>
<li>pod的可用性监控</li>
</ul>
<h2 id="Pod出现异常时，怎么排查问题"><a href="#Pod出现异常时，怎么排查问题" class="headerlink" title="Pod出现异常时，怎么排查问题"></a>Pod出现异常时，怎么排查问题</h2><p>分析：排查问题的思虑</p>
<p>Pod出现异常时，应该：</p>
<ul>
<li>通过kubectl describe pod xxx 查看pod信息</li>
<li>查看pod日志</li>
<li>查看/var/log/message</li>
</ul>
<h2 id="pod的优先级"><a href="#pod的优先级" class="headerlink" title="pod的优先级"></a>pod的优先级</h2><p>分析：主要考察QoS 模型</p>
<h3 id="QoS（Quality-of-Service，服务质量）-模型主要分为："><a href="#QoS（Quality-of-Service，服务质量）-模型主要分为：" class="headerlink" title="QoS（Quality of Service，服务质量） 模型主要分为："></a>QoS（Quality of Service，服务质量） 模型主要分为：</h3><ul>
<li><p>Guaranteed：当 Pod 里的每一个 Container 都同时设置了 requests 和 limits，并且 requests 和 limits 值相等的时候。</p>
<p>当这个 Pod 创建之后，它的 qosClass 字段就会被 Kubernetes 自动设置为 Guaranteed。需要注意的是，当  Pod 仅设置了 limits 没有设置 requests 的时候，Kubernetes 会自动为它设置与 limits 相同的  requests 值，所以，这也属于 Guaranteed 情况。</p>
</li>
<li><p>Burstable：当 Pod 不满足 Guaranteed 的条件，但至少有一个 Container 设置了 requests。</p>
</li>
<li><p>BestEffort：一个 Pod 既没有设置 requests，也没有设置 limits</p>
</li>
</ul>
<p>QoS 模型作用： QoS 划分的主要应用场景，是当宿主机资源紧张的时候，kubelet 对 Pod 进行 Eviction（即资源回收）时需要用到的。</p>
<h3 id="通过PriorityClass设置-Pod-优先级"><a href="#通过PriorityClass设置-Pod-优先级" class="headerlink" title="通过PriorityClass设置 Pod 优先级"></a>通过PriorityClass设置 Pod 优先级</h3><h3 id="参考文档-4"><a href="#参考文档-4" class="headerlink" title="参考文档"></a>参考文档</h3><ul>
<li><a href="https://wangzhangtao.com/2020/10/02/40-44-%E4%BD%9C%E4%B8%9A%E8%B0%83%E5%BA%A6%E5%92%8C%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/#QoS-%E6%A8%A1%E5%9E%8B" target="_blank" rel="noopener">作业调度和资源管理</a></li>
</ul>
<h2 id="pod发生驱逐的情况"><a href="#pod发生驱逐的情况" class="headerlink" title="pod发生驱逐的情况"></a>pod发生驱逐的情况</h2><p>分析：主要考察可压缩资源和不可压缩资源的区分</p>
<p>pod发生驱逐的情况有：</p>
<ul>
<li>内存不足</li>
<li>宿主机磁盘空间</li>
<li>容器运行时镜像存储空间</li>
</ul>
<h2 id="pod原地升级"><a href="#pod原地升级" class="headerlink" title="pod原地升级"></a>pod原地升级</h2><p>总结：这种只更新 Pod 中某一个或多个容器版本、而不影响整个 Pod 对象、其余容器的升级方式，被我们称为 Kubernetes 中的原地升级。</p>
<p>原地升级为发布效率带来了以下优化点：</p>
<ol>
<li>节省了调度的耗时，Pod 的位置、资源都不发生变化；</li>
<li>节省了分配网络的耗时，Pod 还使用原有的 IP；</li>
<li>节省了分配、挂载远程盘的耗时，Pod 还使用原有的 PV（且都是已经在 Node 上挂载好的）；</li>
<li>节省了大部分拉取镜像的耗时，因为 Node 上已经存在了应用的旧镜像，当拉取新版本镜像时只需要下载很少的几层 layer。</li>
</ol>
<h3 id="参考文档-5"><a href="#参考文档-5" class="headerlink" title="参考文档"></a>参考文档</h3><ul>
<li><a href="https://mp.weixin.qq.com/s/vw-bO5ekqvrKPzlqkzh7SA" target="_blank" rel="noopener">k8s原地升级</a></li>
</ul>
<h1 id="k8s网络"><a href="#k8s网络" class="headerlink" title="k8s网络"></a>k8s网络</h1><h2 id="service"><a href="#service" class="headerlink" title="service"></a>service</h2><h3 id="参考文档-6"><a href="#参考文档-6" class="headerlink" title="参考文档"></a>参考文档</h3><ul>
<li><a href="https://v1-16.docs.kubernetes.io/zh/docs/concepts/services-networking/service/#proxy-mode-ipvs" target="_blank" rel="noopener">官网service介绍</a></li>
</ul>
<h2 id="“网络栈”有哪些组件"><a href="#“网络栈”有哪些组件" class="headerlink" title="“网络栈”有哪些组件"></a>“网络栈”有哪些组件</h2><p>“网络栈”组建为：a.网卡，b.回环设备，c.路由表，d.iptables规则。这些要素构成了一台主机的网络环境。</p>
<h2 id="flannel的几种网络模式"><a href="#flannel的几种网络模式" class="headerlink" title="flannel的几种网络模式"></a>flannel的几种网络模式</h2><p>flannel的三种网络模式：</p>
<ul>
<li>udp：</li>
<li>路由模式：</li>
<li>vxlan：</li>
</ul>
<h2 id="service的实现机制"><a href="#service的实现机制" class="headerlink" title="service的实现机制"></a>service的实现机制</h2><h2 id="iptables和ipvs区别"><a href="#iptables和ipvs区别" class="headerlink" title="iptables和ipvs区别"></a>iptables和ipvs区别</h2><p>ipvsadm命令行用法和iptables命令行用法非常相似，毕竟是兄弟，比如<code>-L</code>列举，<code>-A</code>添加，<code>-D</code>删除。</p>
<h3 id="3-4-总结"><a href="#3-4-总结" class="headerlink" title="3.4 总结"></a>3.4 总结</h3><p>Kubernetes的ClusterIP和NodePort都是通过ipvs service实现的，Pod当作ipvs service的server，通过NAT MQSQ实现转发。</p>
<p>简单来说kube-proxy主要在所有的Node节点做如下三件事:</p>
<ol>
<li>如果没有dummy类型虚拟网卡，则创建一个，默认名称为<code>kube-ipvs0</code>;</li>
<li>把Kubernetes ClusterIP地址添加到<code>kube-ipvs0</code>，同时添加到ipset中。</li>
<li>创建ipvs service，ipvs service地址为ClusterIP以及Cluster Port，ipvs server为所有的Endpoint地址，即Pod IP及端口。</li>
</ol>
<p>使用ipvs作为kube-proxy后端，不仅提高了转发性能，结合ipset还使iptables规则变得更“干净”清楚，从此再也不怕iptables。</p>
<h3 id="参考文档-7"><a href="#参考文档-7" class="headerlink" title="参考文档"></a>参考文档</h3><ul>
<li><a href="https://kubernetes.io/zh/blog/2018/07/09/ipvs-based-in-cluster-load-balancing-deep-dive/" target="_blank" rel="noopener">IPVS 代理模式</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/94418251" target="_blank" rel="noopener">IPVS从入门到精通kube-proxy实现原理</a></li>
</ul>
<h2 id="iptables和ipvs实现过程"><a href="#iptables和ipvs实现过程" class="headerlink" title="iptables和ipvs实现过程"></a>iptables和ipvs实现过程</h2><p>iptables通过防火墙规则实现后端pod转发</p>
<p>ipvs通过内核和iptables实现</p>
<h3 id="ipvs实现过程"><a href="#ipvs实现过程" class="headerlink" title="ipvs实现过程"></a>ipvs实现过程</h3><p>IPVS 中有三种代理模式：NAT（masq），IPIP 和 DR。 只有 NAT 模式支持端口映射。 Kube-proxy 利用 NAT 模式进行端口映射。 以下示例显示 IPVS 服务端口3080到Pod端口8080的映射。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@ikj-128 ~]# ipvsadm -ln   | grep 23018</span><br><span class="line">TCP  127.0.0.1:23018 nq</span><br><span class="line">TCP  172.16.128.1:23018 nq</span><br><span class="line">TCP  192.168.70.128:23018 nq</span><br></pre></td></tr></table></figure>

<p>IPVS 代理中的 Iptables 和 Ipset</p>
<p>IPVS 用于负载均衡，它无法处理 kube-proxy 中的其他问题，例如 包过滤，数据包欺骗，SNAT 等</p>
<p>IPVS proxier 在上述场景中利用 iptables。 具体来说，ipvs proxier 将在以下4种情况下依赖于 iptables：</p>
<ul>
<li>kube-proxy 以 –masquerade-all = true 开头</li>
<li>在 kube-proxy 启动中指定集群 CIDR</li>
<li>支持 Loadbalancer 类型服务</li>
<li>支持 NodePort 类型的服务</li>
</ul>
<p>但是，我们不想创建太多的 iptables 规则。 所以我们采用 ipset 来减少 iptables 规则。 以下是 IPVS proxier 维护的 ipset 集表：</p>
<h2 id="service地址可以ping通吗"><a href="#service地址可以ping通吗" class="headerlink" title="service地址可以ping通吗"></a>service地址可以ping通吗</h2><p>service地址分两种情况：</p>
<ul>
<li>iptables的地址不可以ping通</li>
<li>ipvs地址可以ping通</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ip addr show kube-ipvs0</span><br><span class="line">4: kube-ipvs0: &lt;BROADCAST,NOARP&gt; mtu 1500 qdisc noop state DOWN group default</span><br><span class="line">    link&#x2F;ether 46:6b:9e:af:b0:60 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.96.0.1&#x2F;32 brd 10.96.0.1 scope global kube-ipvs0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet 10.96.0.10&#x2F;32 brd 10.96.0.10 scope global kube-ipvs0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet 10.96.54.11&#x2F;32 brd 10.96.54.11 scope global kube-ipvs0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"># ethtool -i kube-ipvs0 | grep driver</span><br><span class="line">driver: dummy</span><br></pre></td></tr></table></figure>

<p>ip addr show kube-ipvs0</p>
<p>可见kube-proxy首先会创建一个dummy虚拟网卡kube-ipvs0，然后把所有的Service IP添加到kube-ipvs0中。</p>
<p>我们知道基于iptables的Service，ClusterIP是一个虚拟的IP，因此这个IP是ping不通的，但ipvs中这个IP是在每个节点上真实存在的，因此可以ping通:</p>
<h2 id="k8s服务之间是如何调用的"><a href="#k8s服务之间是如何调用的" class="headerlink" title="k8s服务之间是如何调用的"></a>k8s服务之间是如何调用的</h2><p>通过service来进行调用</p>
<h2 id="外部服务访问k8s内部pod的几种方式"><a href="#外部服务访问k8s内部pod的几种方式" class="headerlink" title="外部服务访问k8s内部pod的几种方式"></a>外部服务访问k8s内部pod的几种方式</h2><ul>
<li><strong>hostNetwork</strong>：true  在pod中使用该配置，在这种Pod中运行的应用程序可以直接看到pod启动的主机的网络接口。</li>
<li><strong>hostPort</strong>：直接将容器的端口与所调度的节点上的端口路由，这样用户就可以通过主机的IP来访问Pod了</li>
<li><strong>NodePort：</strong>让外部能够直接访问service，需要将service type修改为 <code>nodePort</code>。</li>
<li><strong>LoadBalancer</strong>: <code>LoadBalancer</code> 只能在service上定义。这是公有云提供的负载均衡器</li>
<li><strong>Ingress</strong>: 一个像nginx或HAProxy的负载均衡器和一个控制器守护进程。控制器守护程序从Kubernetes接收所需的Ingress配置。</li>
</ul>
<h3 id="参考文档："><a href="#参考文档：" class="headerlink" title="参考文档："></a>参考文档：</h3><ul>
<li><a href="https://jimmysong.io/blog/accessing-kubernetes-pods-from-outside-of-the-cluster/" target="_blank" rel="noopener">从外部访问Kubernetes中的Pod</a></li>
</ul>
<h2 id="Kubernetes之Network-Policy"><a href="#Kubernetes之Network-Policy" class="headerlink" title="Kubernetes之Network Policy"></a>Kubernetes之Network Policy</h2><p><strong>Network policy</strong>：设置pod进出网络的策略，k8s本身并不支持，主要靠以下网络插件来支持。</p>
<ul>
<li>calico</li>
<li>canal</li>
<li>Cilium</li>
<li>Romana</li>
<li>Weave</li>
</ul>
<h3 id="参考文档-8"><a href="#参考文档-8" class="headerlink" title="参考文档"></a>参考文档</h3><ul>
<li><a href="https://kubernetes.io/docs/concepts/cluster-administration/addons/#networking-and-network-policy" target="_blank" rel="noopener">网络和网络规则</a></li>
</ul>
<h2 id="Headless-Service-zookeeper"><a href="#Headless-Service-zookeeper" class="headerlink" title="Headless Service: zookeeper"></a>Headless Service: zookeeper</h2></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">会跳的小蚂蚁</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://wang.ikongjian.com/2020/11/10/wangzt-test-k8s-know/">http://wang.ikongjian.com/2020/11/10/wangzt-test-k8s-know/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://wang.ikongjian.com" target="_blank">蚂蚁博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> donate<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="/img/alipay.jpg" alt="支付宝"/><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><div class="post-ad"><ins class="adsbygoogle" style="display:block" data-ad-format="fluid" data-ad-layout-key="xxxxxxxxxxxx" data-ad-client="ca-pub-xxxxxxxxxx" data-ad-slot="xxxxxxxxxx"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2021/01/01/linux-tmp/"><img class="prev_cover" src="/img/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">linux-tmp</div></div></a></div><div class="next-post pull_right"><a href="/2020/11/03/%E6%95%B0%E6%8D%AE%E7%9B%98%E5%AD%98%E5%82%A8/"><img class="next_cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">数据盘存储</div></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var requestSetting = function (from,set) {
  var from = from
  var setting = set.split(',').filter(function(item){
  return from.indexOf(item) > -1
  });
  setting = setting.length == 0 ? from :setting;
  return setting
}

var guestInfo = requestSetting(['nick','mail','link'],'nick,mail,link')
var requiredFields = requestSetting(['nick','mail','link'],'nick,mail')

window.valine = new Valine({
  el:'#vcomment',
  appId: '3trHicwpGcV9ectvS8IUTPyA-gzGzoHsz',
  appKey: 'O89QU06amIo1zHhNLV9BMxU7',
  notify: false,
  verify: false,
  placeholder: 'Please leave your footprints',
  avatar: 'monsterid',
  meta: guestInfo,
  pageSize: '10',
  lang: 'en',
  recordIP: false,
  serverURLs: '',
  emojiCDN: '',
  emojiMaps: "",
  enableQQ: false,
  requiredFields: requiredFields
});</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By 会跳的小蚂蚁</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="icp"><a href="http://www.beian.gov.cn/portal/index.do" target="_blank" rel="noopener"><img class="icp-icon" src="/img/icp.png"/><span>京ICP备20023989号</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script defer id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@3/instantpage.min.js" type="module"></script><script src="/js/search/local-search.js"></script></body></html>